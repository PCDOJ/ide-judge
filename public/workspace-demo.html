<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workspace Demo - IDE Judge</title>
    <link rel="stylesheet" href="/css/workspace.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Workspace Toolbar -->
    <div class="workspace-toolbar">
        <div class="toolbar-left">
            <button class="btn-workspace btn-back" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> Quay l·∫°i
            </button>
            <div class="problem-info">
                <span class="problem-code" id="problem-code">PROB001</span>
                <span> - </span>
                <span id="problem-title">T·ªïng hai s·ªë</span>
            </div>
        </div>
        <div class="toolbar-right">
            <div class="timer" id="timer">
                <i class="fas fa-clock"></i>
                <span id="time-remaining">--:--:--</span>
            </div>
            <button class="btn-workspace btn-view-pdf" onclick="togglePDF()" id="view-pdf-btn" style="display: none;">
                <i class="fas fa-file-pdf"></i> ƒê·ªÅ b√†i
            </button>
            <button class="btn-workspace btn-run" onclick="showRunCodeModal()" style="background: #28a745;">
                <i class="fas fa-play"></i> Run Code
            </button>
            <button class="btn-workspace btn-save" onclick="saveManually()">
                <i class="fas fa-save"></i> L∆∞u
            </button>
            <button class="btn-workspace btn-submit" onclick="submitCode()">
                <i class="fas fa-paper-plane"></i> N·ªôp b√†i
            </button>
        </div>
    </div>

    <!-- Sync Status -->
    <div id="sync-status" class="sync-status idle"></div>

    <!-- Toggle Sidebar Button -->
    <button class="toggle-sidebar-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- File List Sidebar -->
    <div class="file-list-sidebar" id="file-sidebar">
        <div class="sidebar-header">
            <span>Files</span>
            <div style="display: flex; align-items: center; gap: 10px;">
                <button onclick="refreshFileList()" class="btn-refresh-files" title="Refresh file list">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <span id="files-count">0</span>
            </div>
        </div>
        <div id="file-list">
            <!-- Files will be loaded here -->
        </div>
    </div>

    <!-- Split Container for PDF and Workspace -->
    <div class="split-container">
        <!-- PDF Panel -->
        <div class="pdf-panel hidden" id="pdfPanel">
            <iframe id="pdfViewer" class="pdf-viewer"></iframe>
        </div>

        <!-- Resize Handle -->
        <div class="resize-handle hidden" id="resizeHandle"></div>

        <!-- Workspace Container -->
        <div class="workspace-container fullscreen" id="workspaceContainer">
            <!-- Code-server iframe s·∫Ω ƒë∆∞·ª£c load ·ªü ƒë√¢y -->
            <iframe id="workspace-iframe" class="workspace-iframe" src="about:blank"></iframe>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="workspace-loading" id="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">ƒêang kh·ªüi t·∫°o workspace...</div>
    </div>

    <!-- Run Code Modal -->
    <div class="modal fade" id="runCodeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-play"></i> Run Code
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Ch·ªçn file c·∫ßn run:</label>
                        <select class="form-select" id="file-selector">
                            <option value="">-- Ch·ªçn file --</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Ng√¥n ng·ªØ: <strong id="detected-language">-</strong></label>
                    </div>
                    <div class="mb-3" id="cpp-version-selector" style="display: none;">
                        <label class="form-label">C++ Version:</label>
                        <select class="form-select" id="cpp-version">
                            <option value="c++14">C++14</option>
                            <option value="c++17">C++17</option>
                            <option value="c++20" selected>C++20 (Default)</option>
                            <option value="c++23">C++23</option>
                        </select>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        Code s·∫Ω ƒë∆∞·ª£c compile v√† run trong VSCode terminal. Vui l√≤ng ki·ªÉm tra terminal ƒë·ªÉ xem k·∫øt qu·∫£.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-success" onclick="runCode()">
                        <i class="fas fa-play"></i> Run
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script src="/js/workspace-client.js"></script>
    <script>
        // Global variables
        let workspaceClient = null;
        let contestId = null;
        let problemId = null;
        let problemCode = null;
        window.codeSaved = false; // Track if code has been saved

        // Initialize workspace khi page load
        window.addEventListener('DOMContentLoaded', async () => {
            // Get params from URL
            const urlParams = new URLSearchParams(window.location.search);
            contestId = parseInt(urlParams.get('contestId'));
            problemId = parseInt(urlParams.get('problemId'));
            problemCode = urlParams.get('problemCode');

            // Validate required parameters
            if (!contestId || !problemId) {
                alert('Thi·∫øu th√¥ng tin contestId ho·∫∑c problemId. Vui l√≤ng m·ªü workspace t·ª´ trang exam.');
                window.location.href = '/exams.html';
                return;
            }

            // Set default problemCode if not provided
            if (!problemCode) {
                problemCode = 'PROB' + String(problemId).padStart(3, '0');
            }

            console.log('[Workspace] Initialized with:', { contestId, problemId, problemCode });

            // Update UI
            document.getElementById('problem-code').textContent = problemCode;

            try {
                // Initialize workspace client
                workspaceClient = new WorkspaceClient();
                const session = await workspaceClient.init(contestId, problemId);

                console.log('Workspace initialized:', session);

                // Load code-server iframe directly from port 8080 to avoid proxy origin issues
                const folderPath = `/workspace/${session.workspacePath}`;
                const codeServerUrl = `http://localhost:8080/?folder=${encodeURIComponent(folderPath)}`;

                console.log('[Workspace] Loading code-server iframe:', {
                    folderPath: folderPath,
                    encodedUrl: codeServerUrl,
                    sessionId: session.sessionId,
                    workspacePath: session.workspacePath
                });

                const iframe = document.getElementById('workspace-iframe');

                // Add load event listener to track iframe loading
                iframe.addEventListener('load', () => {
                    console.log('[Workspace] Code-server iframe loaded successfully');
                });

                iframe.addEventListener('error', (e) => {
                    console.error('[Workspace] Code-server iframe load error:', e);
                });

                iframe.src = codeServerUrl;

                // Load file list
                await loadFileList();

                // Start auto-refresh file list
                startAutoRefresh();

                // Start timer
                startTimer(session);

                // Show PDF button (always show since all problems should have PDF)
                document.getElementById('view-pdf-btn').style.display = 'inline-block';

                // Hide loading overlay
                document.getElementById('loading-overlay').style.display = 'none';

            } catch (error) {
                console.error('Workspace initialization error:', error);
                alert('Kh√¥ng th·ªÉ kh·ªüi t·∫°o workspace: ' + error.message);
            }
        });

        // Load file list
        async function loadFileList() {
            try {
                const response = await fetch(`/api/workspace/files/${contestId}/${problemId}`);
                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.message);
                }

                const fileList = document.getElementById('file-list');
                fileList.innerHTML = '';

                if (data.files.length === 0) {
                    fileList.innerHTML = '<div style="padding: 15px; color: #6c757d; text-align: center;">Ch∆∞a c√≥ file n√†o</div>';
                } else {
                    data.files.forEach(file => {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item' + (file.is_main_file ? ' main-file' : '');

                        // L·∫•y icon v√† m√†u d·ª±a tr√™n ƒëu√¥i file th·ª±c t·∫ø
                        const fileIcon = getFileIcon(file.file_name);
                        const fileColor = getFileColor(file.file_name);

                        fileItem.innerHTML = `
                            <i class="${fileIcon} file-icon" style="color: ${fileColor};"></i>
                            <span class="file-name">${file.file_name}</span>
                            <span class="file-size">(${formatFileSize(file.file_size)})</span>
                        `;
                        fileList.appendChild(fileItem);
                    });
                }

                document.getElementById('files-count').textContent = data.files.length;

            } catch (error) {
                console.error('Load file list error:', error);
            }
        }

        // Helper: L·∫•y icon cho file d·ª±a tr√™n extension
        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const iconMap = {
                'cpp': 'fab fa-cuttlefish',
                'c': 'fab fa-cuttlefish',
                'h': 'fas fa-file-code',
                'hpp': 'fas fa-file-code',
                'py': 'fab fa-python',
                'java': 'fab fa-java',
                'js': 'fab fa-js-square',
                'ts': 'fas fa-file-code',
                'go': 'fas fa-file-code',
                'rs': 'fas fa-file-code',
                'txt': 'fas fa-file-alt',
                'md': 'fab fa-markdown',
                'json': 'fas fa-file-code',
                'sh': 'fas fa-terminal'
            };
            return iconMap[ext] || 'fas fa-file-code';
        }

        // Helper: L·∫•y m√†u cho file d·ª±a tr√™n extension
        function getFileColor(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const colorMap = {
                'cpp': '#00599C',
                'c': '#555555',
                'h': '#A8B9CC',
                'hpp': '#A8B9CC',
                'py': '#3776AB',
                'java': '#007396',
                'js': '#F7DF1E',
                'ts': '#3178C6',
                'go': '#00ADD8',
                'rs': '#CE422B',
                'txt': '#6c757d',
                'md': '#083FA1',
                'json': '#292929',
                'sh': '#4EAA25'
            };
            return colorMap[ext] || '#667eea';
        }

        // Save manually
        async function saveManually() {
            try {
                // Sync files to server first
                await workspaceClient.syncToServer();

                // Save code to submission
                const response = await fetch('/api/workspace/save-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sessionId: workspaceClient.sessionId,
                        contestId: contestId,
                        problemId: problemId
                    })
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.message);
                }

                await loadFileList();

                // Show success notification
                showNotification('success', 'ƒê√£ l∆∞u th√†nh c√¥ng!');

                // Mark as saved
                window.codeSaved = true;

            } catch (error) {
                console.error('Save error:', error);
                showNotification('error', 'L∆∞u th·∫•t b·∫°i: ' + error.message);
            }
        }

        // Submit code
        async function submitCode() {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën n·ªôp b√†i? Sau khi n·ªôp b·∫°n kh√¥ng th·ªÉ ch·ªânh s·ª≠a.')) {
                return;
            }

            try {
                const result = await workspaceClient.submitCode();
                alert(`N·ªôp b√†i th√†nh c√¥ng!\n\nS·ªë files: ${result.filesCount}\nFile ch√≠nh: ${result.mainFile}`);

                // Redirect v·ªÅ trang exam
                setTimeout(() => {
                    window.location.href = `/exam-view.html?id=${contestId}`;
                }, 2000);

            } catch (error) {
                console.error('Submit error:', error);
                alert('N·ªôp b√†i th·∫•t b·∫°i: ' + error.message);
            }
        }

        // Toggle PDF panel
        function togglePDF() {
            const pdfPanel = document.getElementById('pdfPanel');
            const workspaceContainer = document.getElementById('workspaceContainer');
            const resizeHandle = document.getElementById('resizeHandle');
            const toggleBtn = document.getElementById('view-pdf-btn');
            const pdfViewer = document.getElementById('pdfViewer');

            if (pdfPanel.classList.contains('hidden')) {
                // Show PDF
                pdfPanel.classList.remove('hidden');
                workspaceContainer.classList.remove('fullscreen');
                resizeHandle.classList.remove('hidden');
                pdfPanel.style.width = '50%';
                workspaceContainer.style.width = '50%';
                toggleBtn.innerHTML = '<i class="fas fa-file-pdf"></i> ·∫®n ƒë·ªÅ';

                // Load PDF if not loaded yet
                if (!pdfViewer.src || pdfViewer.src === 'about:blank') {
                    pdfViewer.src = `/api/user/problems/${problemId}/pdf#zoom=100`;
                }
            } else {
                // Hide PDF
                pdfPanel.classList.add('hidden');
                pdfPanel.style.width = '0';
                workspaceContainer.classList.add('fullscreen');
                workspaceContainer.style.width = '100%';
                resizeHandle.classList.add('hidden');
                toggleBtn.innerHTML = '<i class="fas fa-file-pdf"></i> ƒê·ªÅ b√†i';
            }
        }

        // Go back
        function goBack() {
            console.log('[Workspace] goBack() called, contestId:', contestId);

            // Validate contestId before redirect
            if (!contestId) {
                console.error('[Workspace] contestId is undefined, redirecting to exams.html');
                window.location.href = '/exams.html';
                return;
            }

            const redirectUrl = `/exam-view.html?id=${contestId}`;
            console.log('[Workspace] Redirecting to:', redirectUrl);

            // N·∫øu ƒë√£ l∆∞u th√¨ kh√¥ng h·ªèi l·∫°i
            if (window.codeSaved) {
                window.location.href = redirectUrl;
                return;
            }

            // N·∫øu ch∆∞a l∆∞u th√¨ h·ªèi
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën tho√°t? Code ch∆∞a ƒë∆∞·ª£c l∆∞u.')) {
                window.location.href = redirectUrl;
            }
        }

        // Show notification
        function showNotification(type, message) {
            // T·∫°o notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${message}</span>
            `;

            // Th√™m v√†o body
            document.body.appendChild(notification);

            // Hi·ªán notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            // ·∫®n sau 3 gi√¢y
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('file-sidebar');
            sidebar.classList.toggle('collapsed');
        }

        // Refresh file list manually
        async function refreshFileList() {
            try {
                const btn = event.target.closest('.btn-refresh-files');
                const icon = btn.querySelector('i');

                // Add spinning animation
                icon.classList.add('fa-spin');
                btn.disabled = true;

                const response = await fetch('/api/workspace/refresh-files', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sessionId: workspaceClient.sessionId,
                        contestId: contestId,
                        problemId: problemId
                    })
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.message);
                }

                // Update file list UI
                const fileList = document.getElementById('file-list');
                fileList.innerHTML = '';

                if (data.files.length === 0) {
                    fileList.innerHTML = '<div style="padding: 15px; color: #6c757d; text-align: center;">Ch∆∞a c√≥ file n√†o</div>';
                } else {
                    data.files.forEach(file => {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item' + (file.is_main_file ? ' main-file' : '');

                        const fileIcon = getFileIcon(file.file_name);
                        const fileColor = getFileColor(file.file_name);

                        fileItem.innerHTML = `
                            <i class="${fileIcon} file-icon" style="color: ${fileColor};"></i>
                            <span class="file-name">${file.file_name}</span>
                            <span class="file-size">(${formatFileSize(file.file_size)})</span>
                        `;
                        fileList.appendChild(fileItem);
                    });
                }

                document.getElementById('files-count').textContent = data.files.length;

                console.log('[Workspace] File list refreshed:', data.filesCount, 'files');

            } catch (error) {
                console.error('Refresh file list error:', error);
                showNotification('error', 'Kh√¥ng th·ªÉ refresh file list: ' + error.message);
            } finally {
                // Remove spinning animation
                const btn = event.target.closest('.btn-refresh-files');
                const icon = btn.querySelector('i');
                icon.classList.remove('fa-spin');
                btn.disabled = false;
            }
        }

        // Auto-refresh file list every 5 seconds
        let autoRefreshInterval = null;
        function startAutoRefresh() {
            // Clear existing interval if any
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }

            // Refresh every 5 seconds
            autoRefreshInterval = setInterval(async () => {
                try {
                    await loadFileList();
                } catch (error) {
                    console.error('Auto-refresh error:', error);
                }
            }, 5000);

            console.log('[Workspace] Auto-refresh started (every 5 seconds)');
        }

        // Stop auto-refresh when leaving page
        window.addEventListener('beforeunload', () => {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });

        // Start timer
        function startTimer(session) {
            // TODO: Implement countdown timer based on session.expiresAt
            const timerElement = document.getElementById('time-remaining');
            
            function updateTimer() {
                // Placeholder - replace with actual logic
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                timerElement.textContent = `${hours}:${minutes}:${seconds}`;
            }

            updateTimer();
            setInterval(updateTimer, 1000);
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Listen to workspace sync status
        window.addEventListener('workspace-sync-status', (e) => {
            console.log('Sync status:', e.detail.status);
            
            // Reload file list after successful sync
            if (e.detail.status === 'saved') {
                loadFileList();
            }
        });

        // Cleanup khi unload
        window.addEventListener('beforeunload', () => {
            if (workspaceClient) {
                workspaceClient.destroy();
            }
        });

        // Show Run Code Modal
        async function showRunCodeModal() {
            try {
                // Get files to populate dropdown
                const response = await fetch(`/api/workspace/files/${contestId}/${problemId}`);
                const data = await response.json();

                if (!data.success || data.files.length === 0) {
                    alert('Kh√¥ng t√¨m th·∫•y file code. Vui l√≤ng t·∫°o file tr∆∞·ªõc.');
                    return;
                }

                // Populate file selector
                const fileSelector = document.getElementById('file-selector');
                fileSelector.innerHTML = '<option value="">-- Ch·ªçn file --</option>';

                // Filter code files only
                const codeExtensions = ['cpp', 'c', 'py', 'java', 'js', 'go', 'rs'];
                const codeFiles = data.files.filter(f => {
                    const ext = f.file_name.split('.').pop().toLowerCase();
                    return codeExtensions.includes(ext);
                });

                if (codeFiles.length === 0) {
                    alert('Kh√¥ng t√¨m th·∫•y file code h·ª£p l·ªá.');
                    return;
                }

                // Add files to dropdown
                codeFiles.forEach(file => {
                    const option = document.createElement('option');
                    option.value = file.file_name;
                    option.textContent = file.file_name;
                    if (file.is_main_file) {
                        option.textContent += ' (Main)';
                        option.selected = true;
                    }
                    fileSelector.appendChild(option);
                });

                // Auto-select first file if no main file
                if (!codeFiles.find(f => f.is_main_file)) {
                    fileSelector.selectedIndex = 1; // Skip "-- Ch·ªçn file --"
                }

                // Update language when file changes
                fileSelector.addEventListener('change', updateLanguageDisplay);

                // Initial language display
                updateLanguageDisplay();

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('runCodeModal'));
                modal.show();

            } catch (error) {
                console.error('Error showing run modal:', error);
                alert('L·ªói khi m·ªü modal: ' + error.message);
            }
        }

        // Update language display based on selected file
        function updateLanguageDisplay() {
            const fileSelector = document.getElementById('file-selector');
            const selectedFile = fileSelector.value;

            if (!selectedFile) {
                document.getElementById('detected-language').textContent = '-';
                document.getElementById('cpp-version-selector').style.display = 'none';
                return;
            }

            const ext = selectedFile.split('.').pop().toLowerCase();

            // Detect language
            const languageMap = {
                'cpp': 'C++',
                'c': 'C',
                'py': 'Python',
                'java': 'Java',
                'js': 'JavaScript',
                'go': 'Go',
                'rs': 'Rust'
            };

            const language = languageMap[ext] || 'Unknown';
            document.getElementById('detected-language').textContent = language;

            // Show C++ version selector only for C++
            const cppSelector = document.getElementById('cpp-version-selector');
            if (ext === 'cpp' || ext === 'c') {
                cppSelector.style.display = 'block';
            } else {
                cppSelector.style.display = 'none';
            }
        }

        // Run Code
        async function runCode() {
            try {
                const fileSelector = document.getElementById('file-selector');
                const selectedFile = fileSelector.value;

                if (!selectedFile) {
                    alert('Vui l√≤ng ch·ªçn file c·∫ßn run.');
                    return;
                }

                const cppVersion = document.getElementById('cpp-version').value;

                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('runCodeModal'));
                modal.hide();

                // Show loading
                showNotification('info', 'ƒêang t·∫°o script ch·∫°y code...');

                // Call API to create run script
                const response = await fetch('/api/workspace/run-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contestId: contestId,
                        problemId: problemId,
                        fileName: selectedFile,
                        cppVersion: cppVersion
                    })
                });

                const data = await response.json();

                if (!data.success) {
                    alert('L·ªói: ' + data.message);
                    return;
                }

                // Show success with command
                const command = data.data.scriptPath;
                const fullCommand = data.data.command;

                // Create a nice notification with copy button
                const notificationHtml = `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <div style="margin-bottom: 10px;">
                            <strong>‚úÖ Script ƒë√£ ƒë∆∞·ª£c t·∫°o!</strong>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>File:</strong> ${data.data.fileName} (${data.data.language})
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>L·ªánh compile & run:</strong>
                            <div style="background: #2d2d2d; color: #f8f8f2; padding: 10px; border-radius: 4px; font-family: monospace; margin-top: 5px; overflow-x: auto;">
                                ${fullCommand}
                            </div>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>C√°ch ch·∫°y:</strong>
                        </div>
                        <ol style="margin: 0; padding-left: 20px;">
                            <li>M·ªü Terminal trong VSCode (Ctrl + \`)</li>
                            <li>Ch·∫°y l·ªánh: <code style="background: #e9ecef; padding: 2px 6px; border-radius: 3px;">${command}</code></li>
                        </ol>
                        <div style="margin-top: 10px;">
                            <button onclick="copyToClipboard('${command}')" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
                                üìã Copy l·ªánh
                            </button>
                        </div>
                    </div>
                `;

                // Show in a custom modal or notification
                showCustomNotification('Run Code', notificationHtml);

            } catch (error) {
                console.error('Run code error:', error);
                alert('L·ªói khi ch·∫°y code: ' + error.message);
            }
        }

        // Copy to clipboard helper
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('success', '‚úÖ ƒê√£ copy l·ªánh v√†o clipboard!');
            }).catch(err => {
                console.error('Copy failed:', err);
                alert('Kh√¥ng th·ªÉ copy. Vui l√≤ng copy th·ªß c√¥ng: ' + text);
            });
        }

        // Show custom notification
        function showCustomNotification(title, htmlContent) {
            // Create modal if not exists
            let customModal = document.getElementById('customNotificationModal');
            if (!customModal) {
                customModal = document.createElement('div');
                customModal.id = 'customNotificationModal';
                customModal.className = 'modal fade';
                customModal.innerHTML = `
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="customNotificationTitle"></h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body" id="customNotificationBody"></div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(customModal);
            }

            document.getElementById('customNotificationTitle').textContent = title;
            document.getElementById('customNotificationBody').innerHTML = htmlContent;

            const modal = new bootstrap.Modal(customModal);
            modal.show();
        }

        // Resize handle functionality
        (function initResizeHandle() {
            const resizeHandle = document.getElementById('resizeHandle');
            const pdfPanel = document.getElementById('pdfPanel');
            const workspaceContainer = document.getElementById('workspaceContainer');
            let isResizing = false;

            resizeHandle.addEventListener('mousedown', (e) => {
                isResizing = true;
                document.body.style.cursor = 'col-resize';
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;

                const containerWidth = document.querySelector('.split-container').offsetWidth;
                const newPdfWidth = (e.clientX / containerWidth) * 100;

                // Gi·ªõi h·∫°n width t·ª´ 20% ƒë·∫øn 80%
                if (newPdfWidth >= 20 && newPdfWidth <= 80) {
                    pdfPanel.style.width = newPdfWidth + '%';
                    workspaceContainer.style.width = (100 - newPdfWidth) + '%';
                }
            });

            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.cursor = 'default';
                }
            });
        })();
    </script>
</body>
</html>

